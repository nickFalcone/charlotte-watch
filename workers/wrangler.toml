# Cloudflare Worker for cache warming (runs on a schedule)
# Deploy with: npx wrangler deploy --config workers/wrangler.toml
#
# Required secrets (set via `npx wrangler secret put <NAME> --config workers/wrangler.toml`):
#   RAPIDAPI_KEY          - OpenWebNinja Real-Time News (RapidAPI)
#   OPENAI_API_KEY        - OpenAI API key (default provider)
#   CACHE_WARMING_SECRET  - Secret for authenticated /warm requests
# Optional secrets:
#   ANTHROPIC_API_KEY     - Anthropic API key (if AI_PROVIDER=anthropic)

name = "charlotte-monitor-cache-warmer"
main = "cache-warmer.ts"
compatibility_date = "2024-01-01"

# Runs every 8 hours: 04:00, 12:00, and 20:00 UTC
# - 04:00 UTC = 11 PM Eastern (prev day EST) / 12 AM Eastern (EDT)
# - 12:00 UTC = 7 AM Eastern (EST) / 8 AM Eastern (EDT)
# - 20:00 UTC = 3 PM Eastern (EST) / 4 PM Eastern (EDT)
[triggers]
crons = ["0 4,12,20 * * *"]

# Environment variables
[vars]
SITE_URL = "https://clt.watch"

# KV namespace for caching parsed news
[[kv_namespaces]]
binding = "CACHE"
id = "80fba4fc58ab41d180087a22b5e1917c"
